<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Solutions - Excel Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9F9F7;
            /* Washi Paper White */
            color: #2C3E50;
            /* Ink Blue */
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Noto Serif JP', serif;
        }

        .washi-card {
            background-color: #FFFFFF;
            border: 1px solid #E2E8F0;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
        }

        .btn-primary {
            background-color: #4A5568;
            /* Muted Indigo */
            color: white;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #2D3748;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: #FFFFFF;
            border: 1px solid #E2E8F0;
            color: #4A5568;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background-color: #F7FAFC;
            border-color: #CBD5E0;
        }

        /* Subtle pattern overlay */
        .bg-pattern {
            background-image: radial-gradient(#E2E8F0 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Japanese Art SVG Styling - Improved Positioning */
        .japanese-art {
            position: absolute;
            top: -20px;
            right: -20px;
            pointer-events: none;
            opacity: 0.8;
            z-index: 0;
            width: 250px;
            height: 250px;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4 bg-pattern">

    <div class="washi-card rounded-xl w-full max-w-md p-10 relative overflow-hidden">
        <!-- Decorative top accent -->
        <div class="absolute top-0 left-0 w-full h-1 bg-[#4A5568] z-10"></div>

        <!-- Japanese Line Art SVG - Refined Design -->
        <svg class="japanese-art" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <filter id="ink-blur" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur in="SourceGraphic" stdDeviation="0.5" />
                </filter>
            </defs>

            <!-- Red Sun (Top Right) -->
            <circle cx="220" cy="60" r="35" fill="#C0392B" opacity="0.8" style="mix-blend-mode: multiply;" />

            <!-- Bamboo Stalks (More organic curves) -->
            <g stroke="#2C3E50" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"
                opacity="0.9">
                <!-- Stalk 1 -->
                <path d="M260 300 Q270 200 240 100" stroke-width="4" />
                <path d="M260 300 M262 250 M265 200 M255 150 M245 100" stroke-width="0" /> <!-- Nodes hint -->

                <!-- Stalk 2 -->
                <path d="M290 300 Q280 220 295 140" stroke-width="3" />

                <!-- Stalk 3 -->
                <path d="M220 300 Q230 250 210 180" stroke-width="2.5" />
            </g>

            <!-- Bamboo Leaves (Cluster) -->
            <g fill="#2C3E50" opacity="0.9">
                <path d="M240 100 Q220 90 200 105 Q220 100 240 100 Z" />
                <path d="M240 100 Q250 80 230 60 Q245 80 240 100 Z" />
                <path d="M240 150 Q220 145 205 155 Q225 150 240 150 Z" />
                <path d="M295 140 Q275 130 260 135 Q280 135 295 140 Z" />
                <path d="M210 180 Q190 170 175 180 Q195 175 210 180 Z" />
            </g>

            <!-- Pagoda Silhouette (Subtle, Bottom Right) -->
            <g stroke="#2C3E50" stroke-width="1.5" fill="none" opacity="0.7" transform="translate(20, 20)">
                <path d="M280 280 L220 280" />
                <path d="M270 260 L230 260" />
                <path d="M260 240 L240 240" />
                <!-- Roofs -->
                <path d="M285 280 L220 280 L215 275" />
                <path d="M275 260 L230 260 L225 255" />
                <path d="M265 240 L240 240 L235 235" />
            </g>
        </svg>

        <div class="mb-10 text-center relative z-10">
            <h1 class="text-3xl font-bold text-[#2C3E50] mb-3 tracking-tight">Excel Generator</h1>
            <p class="text-[#7F8C8D] font-light">Planet Solutions Measurement System</p>
            <div class="mt-2 inline-block px-3 py-1 bg-[#F0FFF4] border border-[#C6F6D5] rounded-full">
                <span class="text-xs text-[#2F855A] font-medium tracking-wide">Updated: Includes House Column</span>
            </div>
        </div>

        <div class="space-y-8 relative z-10">
            <div>
                <label for="rowCount"
                    class="block text-sm font-medium text-[#4A5568] mb-2 tracking-wide uppercase text-xs">Number of
                    Rows</label>
                <div class="relative">
                    <input type="number" id="rowCount" value="200" min="1" max="10000"
                        class="block w-full px-4 py-3 rounded-lg border border-[#E2E8F0] bg-[#F9F9F7] focus:bg-white focus:border-[#4A5568] focus:ring-1 focus:ring-[#4A5568] transition-all outline-none text-[#2C3E50]"
                        placeholder="Enter number of rows">
                </div>
                <p class="text-xs text-[#A0AEC0] mt-2 font-light">Default is 200 rows.</p>
            </div>

            <button onclick="generateExcel()"
                class="btn-primary w-full font-medium py-3 px-6 rounded-lg flex items-center justify-center gap-2">
                <span>Generate & Download Excel</span>
            </button>

            <div class="mt-8 pt-8 border-t border-[#EDF2F7]">
                <p class="text-sm text-[#7F8C8D] mb-4 text-center font-light">Need to edit existing data?</p>
                <a href="excel-editor-dashboard/public/planet_editor.html"
                    class="btn-secondary block w-full font-medium py-3 px-4 rounded-lg text-center">
                    Open Planet Editor Dashboard
                </a>
            </div>
        </div>

        <div id="status" class="mt-8 text-center text-sm hidden relative z-10">
            <span
                class="inline-flex items-center px-4 py-2 rounded-full bg-[#F0FFF4] text-[#2F855A] border border-[#C6F6D5]">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                File Generated Successfully
            </span>
        </div>

        <div class="mt-10 text-center text-xs text-[#A0AEC0] font-light tracking-widest uppercase relative z-10">
            &copy; 2025 Planet Solutions
        </div>
    </div>

    <script>
        function generateExcel() {
            const rowCount = parseInt(document.getElementById('rowCount').value) || 200;
            const statusEl = document.getElementById('status');

            // Define Headers
            const infoHeaders = ["S.No", "Admission No", "Student Name", "Class", "Section", "House", "Gender", "Absent/Present"];
            const measureHeaders = [
                "U1 (SHIRT LENGTH)", "U2 (CHEST)", "U3 (STOMACH)", "U4 (SHOULDER)",
                "U5 (FULL SLEEVE)", "U6 (HALF SLEEVE)", "U7 (KURTHA/SPECIAL FROCK LENGTH)", "U8 (EXTRA CELL)",
                "L1 (PANT LENGTH)", "L2 (WAIST)", "L3 (SHORTS LENGTH)", "L4 (PINOFORE LENGTH)",
                "L5 (SKIRT LENGTH)", "L6 (HIP)", "L7 (THIGH)", "L8 (EXTRA CELL)"
            ];

            // Item Definitions with Type
            const boysItems = [
                { name: "BOYS - FORMAL SHIRT", cols: ["U1", "U2", "U3", "U4", "U6"], type: "Male" },
                { name: "BOYS - TRACK T-SHIRT", cols: ["U1", "U2", "U3", "U4", "U6"], type: "Male" },
                { name: "BOYS - UNIFORM T-SHIRT", cols: ["U1", "U2", "U3", "U4", "U6"], type: "Male" },
                { name: "BOYS - JERKIN", cols: ["U1", "U2", "U3", "U4", "U5"], type: "Male" },
                { name: "BOYS - PULLOVER", cols: ["U1", "U2", "U3", "U4", "U5"], type: "Male" },
                { name: "BOYS - FORMAL PANT", cols: ["L1", "L2"], type: "Male" },
                { name: "BOYS - TRACK PANT", cols: ["L1", "L2"], type: "Male" },
                { name: "BOYS - FORMAL SHORTS", cols: ["L3", "L2"], type: "Male" },
                { name: "BOYS - TRACK SHORTS", cols: ["L3", "L2"], type: "Male" },
                { name: "BOYS - PANT SPECIAL CASE", cols: ["L1", "L2", "L6", "L7"], type: "Male" },
            ];

            const girlsItems = [
                { name: "GIRLS - FORMAL SHIRT", cols: ["U1", "U2", "U3", "U4", "U6"], type: "Female" },
                { name: "GIRLS - TRACK T-SHIRT", cols: ["U1", "U2", "U3", "U4", "U6"], type: "Female" },
                { name: "GIRLS - UNIFORM T-SHIRT", cols: ["U1", "U2", "U3", "U4", "U6"], type: "Female" },
                { name: "GIRLS - JERKIN", cols: ["U1", "U2", "U3", "U4", "U5"], type: "Female" },
                { name: "GIRLS - FULL SLEEVE SHIRT", cols: ["U1", "U2", "U3", "U4", "U5"], type: "Female" },
                { name: "GIRLS - PULLOVER", cols: ["U1", "U2", "U3", "U4", "U5"], type: "Female" },
                { name: "GIRLS - KURTHA SHIRT", cols: ["U7", "U2", "U3", "U4", "U6"], type: "Female" },
                { name: "GIRLS - SPECIAL FROCKS", cols: ["U7", "U2", "U3", "U4", "U6"], type: "Female" },
                { name: "GIRLS - FORMAL PANT", cols: ["L1", "L2"], type: "Female" },
                { name: "GIRLS - TRACK PANT", cols: ["L1", "L2"], type: "Female" },
                { name: "GIRLS - TRACK SHORTS", cols: ["L3", "L2"], type: "Female" },
                { name: "GIRLS - PINOFORE", cols: ["L4", "L2"], type: "Female" },
                { name: "GIRLS - SKIRT", cols: ["L5", "L2"], type: "Female" },
                { name: "GIRLS - PANT SPECIAL CASE", cols: ["L1", "L2", "L6", "L7"], type: "Female" },
            ];

            const allItems = [...boysItems, ...girlsItems];
            const itemHeaders = allItems.map(i => i.name);

            // Combine all headers
            const headers = [...infoHeaders, ...measureHeaders, ...itemHeaders];

            // Create Data Array
            const data = [headers];

            // Helper to get column letter (0-based index to A, B, C...)
            function getColLetter(colIndex) {
                let temp, letter = '';
                while (colIndex >= 0) {
                    temp = (colIndex) % 26;
                    letter = String.fromCharCode(temp + 65) + letter;
                    colIndex = (colIndex - temp - 1) / 26;
                    if (colIndex < 0) break;
                    colIndex--; // adjust for 0-based
                }
                return letter;
            }

            const startMeasureCol = infoHeaders.length;

            const uMap = {};
            for (let i = 1; i <= 8; i++) uMap[`U${i}`] = startMeasureCol + i - 1;

            const lMap = {};
            for (let i = 1; i <= 8; i++) lMap[`L${i}`] = startMeasureCol + 8 + i - 1;

            const startItemCol = headers.length - allItems.length;

            // Generate Rows
            for (let i = 0; i < rowCount; i++) {
                const row = new Array(headers.length).fill("");
                const rowNum = i + 2; // Excel row number (1-based, +1 for header)

                // Fill default "00" for measurements
                for (let c = startMeasureCol; c < startMeasureCol + 16; c++) {
                    row[c] = "00";
                }

                data.push(row);
            }

            // Create Workbook
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);

            // Add Formulas
            for (let r = 0; r < rowCount; r++) {
                const rowNum = r + 2;
                const genderCell = `G${rowNum}`; // Gender is in Column G (Index 6)

                allItems.forEach((item, idx) => {
                    const colIndex = startItemCol + idx;
                    const cellRef = XLSX.utils.encode_cell({ r: rowNum - 1, c: colIndex }); // 0-based row/col

                    const parts = item.cols.map(comp => {
                        let colIdx = -1;
                        if (uMap[comp] !== undefined) colIdx = uMap[comp];
                        else if (lMap[comp] !== undefined) colIdx = lMap[comp];

                        if (colIdx !== -1) {
                            const colLetter = XLSX.utils.encode_col(colIdx);
                            return `${colLetter}${rowNum}`;
                        }
                        return null;
                    }).filter(p => p);

                    // Base Formula: =H2 & "," & I2 ...
                    const concatFormula = parts.join(' & "," & ');

                    // Conditional Formula
                    let finalFormula = "";
                    if (item.type === "Male") {
                        finalFormula = `IF(UPPER(${genderCell})="MALE", ${concatFormula}, "")`;
                    } else if (item.type === "Female") {
                        finalFormula = `IF(UPPER(${genderCell})="FEMALE", ${concatFormula}, "")`;
                    } else {
                        finalFormula = concatFormula;
                    }

                    // Set cell formula
                    if (!ws[cellRef]) ws[cellRef] = { t: 's', v: '' };
                    ws[cellRef].f = finalFormula;
                });
            }

            // Auto-width (approximate)
            const wscols = headers.map(h => ({ wch: h.length + 5 }));
            ws['!cols'] = wscols;

            XLSX.utils.book_append_sheet(wb, ws, "Measurements");

            // Manual Download Logic
            const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });

            function s2ab(s) {
                const buf = new ArrayBuffer(s.length);
                const view = new Uint8Array(buf);
                for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                return buf;
            }

            const blob = new Blob([s2ab(wbout)], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "PLANETFINAL.xlsx";
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 0);

            // Show status
            statusEl.classList.remove('hidden');
            setTimeout(() => statusEl.classList.add('hidden'), 5000);
        }
    </script>
</body>

</html>